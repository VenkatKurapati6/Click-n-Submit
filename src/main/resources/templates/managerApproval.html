<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Pending Timesheet Approvals</title>
    <style>
        .accordion {
            background-color: #eee;
            cursor: pointer;
            padding: 1rem;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 1.1rem;
            transition: 0.3s;
            margin-top: 10px;
        }

        .active, .accordion:hover {
            background-color: #ccc;
        }

        .panel {
            padding: 0 18px;
            display: none;
            overflow: hidden;
            background-color: #f9f9f9;
        }

        .approve-reject-buttons {
            display: flex;
            justify-content: flex-end; 
            margin-bottom: 10px; 
        }

        button.approve, button.reject, button.approve-all, button.reject-all {
            margin: 5px;
            padding: 5px 10px;
        }

        button.approve {
            background-color: #4CAF50;
            color: white;
        }

        button.reject {
            background-color: #f44336;
            color: white;
        }

        button.approve-all {
            background-color: #4CAF50;
            color: white;
        }

        button.reject-all {
            background-color: #f44336;
            color: white;
        }

        table {
            width: 100%;
            margin-top: 10px;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #999;
            padding: 8px;
            text-align: center;
        }
    </style>
</head>
<body>

<h2>Pending Timesheet Approvals</h2>

<div th:each="entry : ${weeklyGroupedTimesheets}">
    <!-- Accordion Button (User + Week Range) -->
    <button class="accordion" th:text="'ðŸ‘¤ ' + ${entry.key}"> </button>
    <div class="panel">
        
        <!-- Approve All / Reject All Buttons (Placed at the top-right corner of each accordion) -->
        <div class="approve-reject-buttons">
            <form method="POST" th:action="@{/manager/timesheet/handleAll}">
                <input type="hidden" th:name="weekRange" th:value="${entry.key}" />
                <button type="submit" name="action" value="approveAll" class="approve-all">Approve All</button>
                <button type="submit" name="action" value="rejectAll" class="reject-all">Reject All</button>
            </form>
        </div>
        
        <!-- Timesheet Table -->
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Login</th>
                    <th>Logout</th>
                    <th>Break</th>
                    <th>Activity</th>
                    <th>Total Hours</th>
                    <th>Comments</th>
                    <th>Approve/Reject</th>
                </tr>
            </thead>
            <tbody>
                <!-- Iterate over each timesheet for the current week -->
				<tr th:each="t : ${entry.value}">
				    <td th:text="${t.date}"></td>
				    <td th:text="${t.loginTime}"></td>
				    <td th:text="${t.logoutTime}"></td>
				    <td th:text="${t.breakMinutes}"></td>
				    <td th:text="${t.activityLog}"></td>
				    <td th:text="${t.totalHoursWorked}"></td>
				    
				    <td>
				        <form method="post" th:action="@{/manager/timesheet/handle}">
				            <input type="hidden" name="timesheetId" th:value="${t.id}" />
				            <input type="hidden" name="userId" th:value="${t.userId}" />
				            <input type="hidden" name="date" th:value="${t.date}" />

				            <textarea name="comment" rows="1" cols="20" placeholder="Manager comment (optional)"></textarea>
				    </td>
				    <td>
				            <button type="submit" name="action" value="approve" class="approve">Approve</button>
				            <button type="submit" name="action" value="reject" class="reject">Reject</button>
				        </form>
				    </td>
				</tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    const acc = document.getElementsByClassName("accordion");
    for (let i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function () {
            this.classList.toggle("active");
            const panel = this.nextElementSibling;
            if (panel.style.display === "block") {
                panel.style.display = "none";
            } else {
                panel.style.display = "block";
            }
        });
    }
</script>

</body>
</html>
